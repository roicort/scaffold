---
import { getCollection } from 'astro:content';
import Card from '../../components/Card.astro';
import PageLayout from '../../layouts/PageLayout.astro';
import Search from 'astro-pagefind/components/Search';
import { SITE_DESCRIPTION, SITE_TITLE } from '../../consts';

const posts = (await getCollection('blog')).sort(
	(a, b) => b.data.pubDate.valueOf() - a.data.pubDate.valueOf(),
);
const [featured, ...rest] = posts;
---

<PageLayout title={`Blog · ${SITE_TITLE}`} description={SITE_DESCRIPTION}>
	<section class="max-w-5xl mx-auto px-5 md:px-8 py-12 space-y-8">
		<div class="card p-5 md:p-6 space-y-3">
			<div class="flex flex-wrap items-center justify-between gap-2">
				<p class="text-xs uppercase tracking-[0.3em] text-subtle m-0">Buscar</p>
				<span class="text-xs text-muted">Resultados de páginas y posts.</span>
			</div>
			<Search
				className="pagefind-ui"
				uiOptions={{
					showImages: false,
					translations: {
						placeholder: 'Buscar...',
						zero_results: 'No se encontraron resultados para {{terms}}',
						search_label: 'Buscar contenido',
						clear_search: 'Limpiar búsqueda',
					},
				}}
			/>
		</div>

		{featured && (
			<div class="grid grid-cols-1">
				<Card
					title={featured.data.title}
					href={`/blog/${featured.id}/`}
					description={featured.data.description}
					date={featured.data.pubDate}
					image={featured.data.heroImage}
					imageAlt={featured.data.title}
					variant="post"
				/>
			</div>
		)}

		{rest.length > 0 && (
			<div class="grid grid-cols-1 md:grid-cols-2 gap-6 lg:gap-8">
				{rest.map((post) => (
					<Card
						title={post.data.title}
						href={`/blog/${post.id}/`}
						description={post.data.description}
						date={post.data.pubDate}
						image={post.data.heroImage}
						imageAlt={post.data.title}
						variant="post"
					/>
				))}
			</div>
		)}
	</section>
</PageLayout>
