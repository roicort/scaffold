---
import { SITE_TITLE } from '../consts';
import HeaderLink from './HeaderLink.astro';

const subpath = import.meta.env.BASE_URL;

---

<header class="fixed top-4 z-30 w-full px-4 md:px-10">
	<div class="mx-auto max-w-6xl rounded-xl border border-[color:var(--color-border)] bg-[color:var(--color-surface)] px-4 py-3 md:px-6 md:py-4 flex flex-col gap-3 md:flex-row md:items-center md:justify-between">
		<div class="flex items-center justify-between gap-4">
			<div class="flex flex-col">
				<h1 class="text-base font-semibold tracking-[0.18em] uppercase m-0">
					<a href={subpath} class="hover:opacity-80 transition-opacity">{SITE_TITLE}</a>
				</h1>
			</div>
		</div>
		<div class="flex flex-col gap-2 md:gap-3 md:flex-row md:items-center md:justify-end">
			<nav class="flex flex-wrap items-center gap-2 md:gap-4 text-[0.72rem] tracking-[0.24em] uppercase text-muted">
				<HeaderLink href="/blog">Blog</HeaderLink>
				<HeaderLink href="/about">About</HeaderLink>
							<button class="theme-toggle" type="button" id="theme-toggle" aria-label="Toggle theme">
				<span class="theme-toggle__dot" aria-hidden="true"></span>
				<span class="theme-toggle__label">Light</span>
			</button>
			</nav>
		</div>
	</div>
</header>

<script is:inline>
const STORAGE_KEY = 'theme';

const getPreferredTheme = () => {
	const stored = localStorage.getItem(STORAGE_KEY);
	if (stored === 'light' || stored === 'dark') return stored;
	return window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light';
};

const applyTheme = (theme) => {
	document.documentElement.dataset.theme = theme;
	const label = document.querySelector('#theme-toggle .theme-toggle__label');
	if (label) label.textContent = theme === 'dark' ? 'Dark' : 'Light';
	const button = document.getElementById('theme-toggle');
	if (button) button.setAttribute('aria-pressed', theme === 'dark' ? 'true' : 'false');
};

const initTheme = () => {
	const theme = getPreferredTheme();
	applyTheme(theme);
};

const toggleTheme = () => {
	const current = document.documentElement.dataset.theme === 'dark' ? 'dark' : 'light';
	const next = current === 'dark' ? 'light' : 'dark';
	localStorage.setItem(STORAGE_KEY, next);
	applyTheme(next);
};

initTheme();

const toggleButton = document.getElementById('theme-toggle');
if (toggleButton) {
	toggleButton.addEventListener('click', toggleTheme);
}
</script>
