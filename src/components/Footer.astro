---
import { getSite } from '../utils/consts';
import { getCollection } from 'astro:content';

const site = await getSite();
import { Icon } from 'astro-icon/components'
import Clock from './Clock.astro';

const today = new Date();
const socials = (await getCollection('socials')).map((entry) => entry.data);
const iconMap: Record<string, string> = {
  x: 'tabler:brand-x',
  twitter: 'tabler:brand-x',
  github: 'tabler:brand-github',
  linkedin: 'tabler:brand-linkedin',
  email: 'tabler:mail',
  mastodon: 'tabler:brand-mastodon',
};
---

<footer class="border-t border-[color:var(--color-border)] bg-[color:var(--color-surface)] py-8">
  <div class="content-shell content-shell--flush">
    <div class="grid gap-10 border-b border-[color:var(--color-border)] pb-10 md:grid-cols-2">
      <div class="space-y-6">
        <p class="text-3xl sm:text-4xl font-semibold tracking-tight text-ink">Resources</p>
        <div class="grid gap-2 sm:grid-cols-2 text-sm text-muted">
          <a class="transition-colors hover:text-ink" href="https://astro.build" target="_blank">Astro Docs</a>
          <a class="transition-colors hover:text-ink" href="https://docs.astro.build/en/guides/content-collections/" target="_blank">Content collections</a>
          <a class="transition-colors hover:text-ink" href="https://tailwindcss.com/docs" target="_blank">Tailwind docs</a>
          <a class="transition-colors hover:text-ink" href="https://github.com/withastro/astro" target="_blank">Astro GitHub</a>
        </div>
      </div>
      <div class="grid gap-8">
        <div class="grid gap-3">
          <p class="text-3xl sm:text-4xl font-semibold tracking-tight text-ink">Connect</p>
          <div class="grid gap-2 sm:grid-cols-2 text-sm text-muted">
            {socials.map((social) => {
              const iconName = social.id ? iconMap[social.id.toLowerCase()] : undefined;
              const fallback = social.label?.trim()?.[0]?.toUpperCase() ?? '?';
              return (
                <a
                  href={social.href}
                  target={social.href.startsWith('http') ? '_blank' : undefined}
                  rel={social.href.startsWith('http') ? 'noreferrer' : undefined}
                  class="flex items-center gap-2 rounded-md px-2 py-1 transition-colors hover:text-ink hover:bg-[color:color-mix(in_oklab,var(--color-ink)_3%,transparent)]"
                >
                  {iconName ? (
                    <Icon
                      name={iconName}
                      size={18}
                      strokeWidth={1.5}
                      class="text-ink"
                      aria-hidden={true}
                    />
                  ) : (
                    <span class="inline-flex h-[26px] w-[26px] items-center justify-center rounded-full border border-[color:var(--color-border)] text-[0.7rem] font-semibold text-ink" aria-hidden="true">{fallback}</span>
                  )}
                  <span class="leading-tight">{social.label}</span>
                </a>
              );
            })}
          </div>
        </div>
        <div class="grid gap-3">
          <p class="text-3xl sm:text-4xl font-semibold tracking-tight text-ink">Navigation</p>
          <div class="grid gap-2 sm:grid-cols-2 text-sm text-muted">
            <a class="transition-colors hover:text-ink" href="/">Home</a>
            <a class="transition-colors hover:text-ink" href="/blog">Blog</a>
            <a class="transition-colors hover:text-ink" href="/about">About</a>
            <a class="transition-colors hover:text-ink" href="/rss.xml">RSS</a>
          </div>
        </div>
      </div>
    </div>
    <div class="grid gap-6 pt-8 pb-4 md:flex md:items-center md:justify-between">
      <p class="text-sm text-muted m-0">{site.title} &copy; NonZeroSum {today.getFullYear()}. All rights reserved.</p>
      <div class="md:text-right space-y-2 md:space-y-1">
        <div class="flex flex-wrap items-center gap-3 md:justify-end">
          <p class="text-2xl sm:text-3xl font-semibold tracking-tight text-ink m-0">MÃ©xico City</p>
          <Clock
            label=""
            timeZone="America/Mexico_City"
            locale="es-MX"
            class="text-sm font-semibold text-ink"
          />
        </div>
        <p class="text-sm text-subtle m-0">Designed by Rodrigo Cortez @ Morelia.</p>
      </div>
    </div>
  </div>
</footer>
